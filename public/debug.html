<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug - Login Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .log-box {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      line-height: 1.5;
    }
    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .log-success {
      color: #28a745;
    }
    .log-error {
      color: #dc3545;
    }
    .log-info {
      color: #0066cc;
    }
    button {
      background: #007AFF;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #0051d5;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    input[type="text"] {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      width: 100%;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Login Debug Test</h1>
    
    <div>
      <label>Password:</label>
      <input type="text" id="password" placeholder="tigger-123" value="">
    </div>
    
    <div>
      <button onclick="testLogin()">Test Login</button>
      <button onclick="clearLogs()">Clear Logs</button>
      <button onclick="testSession()">Test Session Storage</button>
    </div>
    
    <div class="log-box" id="logs"></div>
  </div>

  <script>
    const API_BASE_URL = 'https://tattoo-bath-app.hiyume-2.workers.dev';
    const logsDiv = document.getElementById('logs');

    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.textContent = `[${timestamp}] ${message}`;
      logsDiv.appendChild(entry);
      logsDiv.scrollTop = logsDiv.scrollHeight;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    function clearLogs() {
      logsDiv.innerHTML = '';
      log('Logs cleared');
    }

    async function testLogin() {
      const password = document.getElementById('password').value;
      
      if (!password) {
        log('ERROR: Password is empty', 'error');
        return;
      }

      log(`Starting login with password: "${password}"`, 'info');
      log(`Origin: ${window.location.origin}`, 'info');

      try {
        const loginUrl = `${API_BASE_URL}/api/auth/login`;
        log(`Fetching: ${loginUrl}`, 'info');

        const response = await fetch(loginUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({ password }),
        });

        log(`Response status: ${response.status}`, response.ok ? 'success' : 'error');
        
        const contentType = response.headers.get('content-type');
        log(`Content-Type: ${contentType}`, 'info');

        const setCookie = response.headers.get('set-cookie');
        if (setCookie) {
          log(`Set-Cookie header found: ${setCookie.substring(0, 50)}...`, 'success');
        } else {
          log('WARNING: No Set-Cookie header', 'error');
        }

        const data = await response.json();
        log(`Response JSON: ${JSON.stringify(data)}`, response.ok ? 'success' : 'error');

        if (response.ok && data.success) {
          log('‚úì Login successful!', 'success');
        } else {
          log('‚úó Login failed', 'error');
        }
      } catch (error) {
        log(`ERROR: ${error.message}`, 'error');
        log(`Stack: ${error.stack}`, 'error');
      }
    }

    function testSession() {
      try {
        sessionStorage.setItem('test-key', 'test-value');
        const value = sessionStorage.getItem('test-key');
        if (value === 'test-value') {
          log('‚úì sessionStorage works', 'success');
          sessionStorage.removeItem('test-key');
        } else {
          log('‚úó sessionStorage failed', 'error');
        }
      } catch (error) {
        log(`sessionStorage error: ${error.message}`, 'error');
      }
    }

    // Initialize
    log('Debug page loaded', 'success');
    log(`Browser: ${navigator.userAgent.substring(0, 80)}...`, 'info');
    log(`API Base URL: ${API_BASE_URL}`, 'info');
  </script>
</body>
</html>
